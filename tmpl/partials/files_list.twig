{% set total = files|length %}
<div class="option-list files-root">
    <div class="option-list__actions" style="display:flex; gap:8px; align-items:center; margin: 0 0 8px 0; flex-wrap: wrap;">
        <form
            hx-post="{{ base_url }}/files/upload"
            hx-encoding="multipart/form-data"
            hx-target="closest .files-root"
            hx-swap="innerHTML"
            class="file-upload"
            style="display:flex; gap:8px; align-items:center; min-width:0; flex: 1 1 auto;"
        >
            {# Input fichier masqué visuellement, label stylé « Parcourir » #}
            <input
                class="file-upload__input"
                id="fileUploadInput"
                type="file"
                name="file"
                accept="{{ settings.get('file.upload.acceptedExt') }}"
                required
                onchange="(function(inp){var f=inp.files&&inp.files[0]?inp.files[0].name:'Aucun fichier';var form=inp.closest('form');if(!form) return;var nameEl=form.querySelector('.file-upload__name');if(nameEl){nameEl.textContent=f;nameEl.title=f;}var submit=form.querySelector('button[type=submit]');if(submit){submit.disabled=!(inp.files&&inp.files.length);} })(this)"
            >
            <div class="file-upload__icons" aria-label="Actions fichier">
                <label class="btn btn--secondary file-upload__label" for="fileUploadInput" aria-label="Parcourir" title="Parcourir">
                    <svg viewBox="0 0 24 24" aria-hidden="true" width="18" height="18">
                        <path d="M10 4l2 2h6a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h4z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                        <path d="M8 13h8M8 10h5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                    </svg>
                </label>
                <button type="submit" class="btn btn--primary" aria-label="Envoyer" title="Envoyer" disabled>
                    <svg viewBox="0 0 24 24" aria-hidden="true" width="18" height="18">
                        <path d="M22 2L11 13" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 2l-7 20-4-9-9-4 20-7z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <span class="file-upload__name" aria-live="polite">Aucun fichier</span>
        </form>
    </div>

    {% if total == 0 %}
        <div class="option-list__empty">
            <svg class="option-list__empty-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6 2h7l5 5v15H6z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
                <path d="M13 2v6h6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            </svg>
            <div class="option-list__empty-text">Aucun fichier</div>
            <div class="option-list__empty-help">Ajoutez un fichier à l’aide du bouton ci-dessus.</div>
        </div>
    {% else %}
        <ul class="option-list__items">
            {% for file in files %}
                <li class="option-item file-item" id="file-{{ file.id }}">
                    <div class="option-item__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24">
                            <path d="M6 2h7l5 5v15H6z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
                            <path d="M13 2v6h6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="option-item__content">
                        <div class="option-item__title">{{ file.filename }}</div>
                        <div class="option-item__meta">
                            {{ file.mimeType }} • {{ file.sizeBytes |filesize(2) }}
                            {% if file.createdAt is defined %}
                                • Ajouté le {{ file.createdAt|date('d/m/Y') }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="option-item__actions">
                        <button class="option-item__button"
                                type="button"
                                aria-label="Ajouter ce fichier à la conversation"
                                title="Ajouter à la conversation"
                                data-add-file-id="{{ file.id }}"
                                data-add-file-name="{{ file.filename }}"
                        >
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                        <button class="option-item__button files-item__delete"
                                type="button"
                                aria-label="Supprimer ce fichier"
                                title="Supprimer"
                                hx-delete="{{ base_url }}/files/delete/{{ file.id }}"
                                hx-target="closest .files-root"
                                hx-swap="innerHTML"
                                data-dialog-confirm="Supprimer ce fichier ? Cette action est irréversible."
                                data-dialog-title="Confirmer la suppression"
                                data-dialog-variant="danger"
                                data-dialog-confirm-label="Supprimer"
                                data-dialog-cancel-label="Annuler"
                        >
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M9 3h6m-9 3h12M8 9v9m4-9v9m4-9v9M6 6l1 15a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-15" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
</div>
